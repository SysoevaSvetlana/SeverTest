databaseChangeLog:
  - changeSet:
      id: 001-create-tables
      author: svet
      changes:
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: email
                  type: VARCHAR(255)
                  constraints:
                    unique: true
                    nullable: false
              - column:
                  name: password
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: role
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: supplier
                  type: VARCHAR(50)
                  constraints:
                    nullable: true

        - createTable:
            tableName: products
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: category
                  type: VARCHAR(50)
                  constraints:
                    nullable: false

        - createTable:
            tableName: warehouses
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: buyer_id
                  type: BIGINT
                  constraints:
                    nullable: false

        - createTable:
            tableName: warehouse_stocks
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: warehouse_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: product_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: quantity_kg
                  type: DECIMAL(19,2)
                  constraints:
                    nullable: false

        - addUniqueConstraint:
            tableName: warehouse_stocks
            columnNames: warehouse_id,product_id
            constraintName: uc_warehouse_product

        - createTable:
            tableName: supplier_prices
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: supplier
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: product_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: price_per_kg
                  type: DECIMAL(19,2)
                  constraints:
                    nullable: false
              - column:
                  name: start_date
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: end_date
                  type: DATE
                  constraints:
                    nullable: false

        - createTable:
            tableName: supplies
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: supplier
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: warehouse_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: supply_date
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: created_by
                  type: BIGINT
                  constraints:
                    nullable: false

        - createTable:
            tableName: supply_items
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: supply_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: product_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: weight_kg
                  type: DECIMAL(19,2)
                  constraints:
                    nullable: false
              - column:
                  name: price_per_kg
                  type: DECIMAL(19,2)
                  constraints:
                    nullable: false
              - column:
                  name: total_price
                  type: DECIMAL(19,2)
                  constraints:
                    nullable: false

        - addForeignKeyConstraint:
            baseTableName: warehouses
            baseColumnNames: buyer_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_warehouses_buyer

        - addForeignKeyConstraint:
            baseTableName: warehouse_stocks
            baseColumnNames: warehouse_id
            referencedTableName: warehouses
            referencedColumnNames: id
            constraintName: fk_ws_warehouse

        - addForeignKeyConstraint:
            baseTableName: warehouse_stocks
            baseColumnNames: product_id
            referencedTableName: products
            referencedColumnNames: id
            constraintName: fk_ws_product

        - addForeignKeyConstraint:
            baseTableName: supplier_prices
            baseColumnNames: product_id
            referencedTableName: products
            referencedColumnNames: id
            constraintName: fk_sp_product

        - addForeignKeyConstraint:
            baseTableName: supplies
            baseColumnNames: warehouse_id
            referencedTableName: warehouses
            referencedColumnNames: id
            constraintName: fk_supplies_warehouse

        - addForeignKeyConstraint:
            baseTableName: supplies
            baseColumnNames: created_by
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_supplies_created_by

        - addForeignKeyConstraint:
            baseTableName: supply_items
            baseColumnNames: supply_id
            referencedTableName: supplies
            referencedColumnNames: id
            constraintName: fk_si_supply

        - addForeignKeyConstraint:
            baseTableName: supply_items
            baseColumnNames: product_id
            referencedTableName: products
            referencedColumnNames: id
            constraintName: fk_si_product
